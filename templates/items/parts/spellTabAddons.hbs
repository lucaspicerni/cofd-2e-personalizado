{{#each system.addons as |addon index|}}
<fieldset class="spell-reach-fieldset
  {{#if (eqAny ../item.type "activeSpell" "spellTemplate") }}
    {{#if (or addon.active (gt addon.stacks 0)) }}
      spell-reach-fieldset-chosen
    {{else}}
      spell-reach-fieldset-unchosen
    {{/if}}
  {{/if}}
">
  <legend>
    <span>
      {{ localize "MTA.ReachEffect" }}
    </span>
  </legend>
  {{#if (eq ../item.type 'spell') }}
  <button type="button" data-index="{{index}}" title="{{ localize " MTA.spell.addons.btnRemove" }}"
    class="stoneButton spellAddonRemove">
    <i class="fas fa-times-circle"></i>
  </button>
  {{/if}}
  <div class="form-group form-group-stacked">
    <label>{{ localize "MTA.Description" }}</label>
    <textarea name="system.addons.{{index}}.desc" class="spell-reach-field" data-index="{{index}}" data-field="desc"
      >{{addon.desc}}</textarea>
  </div>
{{#if (eqAny ../item.type "activeSpell" "spellTemplate") }}
  <div class="form-group">
    <label>
      {{#if addon.isStackable}}
        {{ localize "MTA.Stacks" }}
      {{else}}
        {{ localize "MTA.Active" }}
      {{/if}}
    </label>
    {{#if addon.isStackable}}
      <input 
        data-dtype="Number" 
        name="system.addons.{{index}}.stacks" 
        type="number" 
        min="0" 
        value="{{addon.stacks}}" 
      >
    {{else}}
      <input 
        data-dtype="Boolean" 
        name="system.addons.{{index}}.active" 
        type="checkbox" 
        {{checked addon.active}}
      >
    {{/if}}
  </div>
{{/if}}
  <input type="hidden" name="system.addons.{{index}}.prereq.type" value="arcanum" />
  <div class="form-group">
    <label>{{ localize "MTA.RequiredArcanum" }}</label>
    <select name="system.addons.{{index}}.prereq.key" class="spell-reach-field" data-index="{{index}}"
      data-field="prereq" data-subfield="key" >
      {{selectOptions ../reachArcanaOpts selected=addon.prereq.key localize="true"}}
    </select>
  </div>
  <div class="form-group">
    <label for="">{{localize 'MTA.RequiredLevel'}}</label>
    <input type="number" class="spell-reach-field" name="system.addons.{{index}}.prereq.dots"
      value="{{addon.prereq.dots}}" step="1" min="0" max="5" data-field="prereq" data-subfield="dots" />
  </div>
  <div class="form-group">
    <label for="">{{localize 'MTA.IsStackable'}}</label>
    <label class="checkBox">
      <input data-dtype="Boolean" name="system.addons.{{index}}.isStackable" type="checkbox" {{checked addon.isStackable}} data-index="{{index}}" data-field="isStackable">
      <span></span>
    </label>
  </div>

  <div class="spell-reach-costs">
    <div class="spell-reach-costs-label">{{ localize "MTA.spell.addons.headerCosts" }}</div>
    <div class="spell-reach-costs-fields-wrap">
      <div class="spell-reach-costs-field">
        <label>{{ localize "MTA.Reach" }}</label>
        <input type="number" name="system.addons.{{index}}.reachCost"
          value="{{addon.reachCost}}"
          data-index="{{index}}"
          data-field="reachCost" class="spell-reach-field"/>
      </div>
      <div class="spell-reach-costs-field">
        <label>{{ localize "MTA.MageMana" }}</label>
        <input type="number" name="system.addons.{{index}}.manaCost" value="{{addon.manaCost}}" data-index="{{index}}"
          data-field="manaCost" class="spell-reach-field"/>
      </div>
      <div class="spell-reach-costs-field">
        <label>{{ localize "MTA.Willpower" }}</label>
        <input type="number" name="system.addons.{{index}}.willpowerCost" value="{{addon.willpowerCost}}"
          data-index="{{index}}" data-field="willpowerCost" class="spell-reach-field"/>
      </div>
    </div>
  </div>
</fieldset>
{{/each}}
{{#if (eq item.type 'spell')}}
<div class="spell-reach-controls">
  <button type="button" class="stoneButton spellAddonAdd">
    {{ localize "MTA.spell.addons.btnAddReach" }}
  </button>
</div>
{{/if}}